{
    "Slug": "analyzing-your-azure-search-traffic",
    "Title": "Analyzing your Azure Search traffic",
    "Summary": "You told us you'd like to be able to know what's happening inside your search service and we are happy to announce we've rolled out the first phase of Search Traffic Analytics.",
    "Content": "<p>The best resource you have to understand your users is the search box on your site or app - every time they search for something, they are telling exactly what they want. Search not only makes it easier for your users to find what they need in your app, but it can also make it possible for you as the owner of the app to understand what your users are looking for and whether your app is delivering on it.</p>\n\n<p>Imagine you have an e-commerce app, if you could know what the most common queries are, you would get valuable information about the products popular with your users, or if you have queries that return no results at all, it would give you a hint about products you are not currently offering that you could add to your inventory.</p>\n\n<p>You <a href=\"https://feedback.azure.com/forums/263029-azure-search/suggestions/6847144-provide-some-sort-of-usage-feedback-qps\">told us</a> you&#39;d like to be able to know what&#39;s happening inside your search service and we are happy to announce that we have rolled out the first phase of Search Traffic Analytics that will let you gain visibility into your search service and unlock insights about your users and their behavior.</p>\n\n<p>So, how does it work? Every time a request is made to your search service, we can optionally log that request together with some useful information and we do aggregations to calculate some key metrics. When you enable Search Traffic Analytics, those two streams of data are copied to your own <a href=\"https://azure.microsoft.com/en-us/services/storage/\">Azure Storage</a> account. In particular, you&rsquo;ll have two blob containers:</p>\n\n<ul>\n <li><strong>Operation logs</strong>: These are your search service logs, all of your requests will be available in this container. This will let you answer business questions like: &ldquo;What are your most-searched-for products&rdquo; or &ldquo;Which search terms are returning empty results,&rdquo;as well as operational aspects like indexing rate or API version usage.</li>\n <li><strong>Metrics</strong>: These provide you aggregated calculations for operational aspects. The only available metric today is Latency but we are working to add others like QPS soon.</li>\n</ul>\n\n<p>Search domains can be vastly different and it&rsquo;s partly because of that that we decided to separate the data access layer from the consumption and analytics layer. We want to give you the flexibility to manipulate and analyze the data in the way that works best for you.</p>\n\n<h2>Analyzing your data with Power BI</h2>\n\n<p>We wanted to make it very easy to start, and that&rsquo;s why we partnered with Power BI to offer a <a href=\"https://go.microsoft.com/fwlink/p/?LinkId=718214\">Content Pack</a> that will let you have a basic dashboard in minutes, and that you will be able to customize to your own needs, creating new visualizations or sharing reports with your team.</p>\n\n<p>When you connect Power BI to your Azure Search analytics storage, the service will collect data for the last 30 days and generate four reports for different dimensions of your service.</p>\n\n<h3>1.&nbsp;&nbsp;&nbsp; Search<img alt=\"Search report\" border=\"0\" height=\"344\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3b582aef-0d15-48d9-b0a0-0ab7715716a0.png\" style=\"background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; margin-right: auto; border-image: none\" title=\"Search report\" width=\"610\"></h3>\n\n<p>A quick glance at how your users are searching. You can see the search volume over time, the most common search queries and queries without results. Also included are two visualizations that show the search distribution across indices and the number of documents returned over time.</p>\n\n<h3>2.&nbsp;&nbsp;&nbsp; Indexing</h3>\n\n<p><img alt=\"Indexing report\" border=\"0\" height=\"351\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/747df87f-7900-44b3-a904-bdcfafc049ab.png\" style=\"background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; margin-right: auto; border-image: none\" title=\"Indexing report\" width=\"610\">Similar to the previous report but in this case it focuses on indexing operations. You will be able to see how many documents you have indexed over time and, particularly interesting for services with a high indexing load, we also included a graph that shows the number of 503s which can help you understand if you are putting too much pressure on your system.</p>\n\n<h3>3.&nbsp;&nbsp;&nbsp; Service Stats</h3>\n\n<p><img alt=\"Service stats report\" border=\"0\" height=\"343\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/7dc8eb9d-caa6-40b8-802f-28891759f05d.png\" style=\"background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; margin-right: auto; border-image: none\" title=\"Service stats report\" width=\"610\"></p>\n\n<p>This report contains information about all the operations that have been executed against your service. You can drill down on API Version or Operation Category, and you can see which queries caused the search service to return a particular result. This last part is very useful to track down bugs that result in failed requests.</p>\n\n<h3>4.&nbsp;&nbsp;&nbsp; Latency</h3>\n\n<p><img alt=\"Latency report\" border=\"0\" height=\"346\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/37cf3d1d-6fe0-4bb5-a721-1117a54d52c8.png\" style=\"background-image: none; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; margin-right: auto; border-image: none\" title=\"Latency report\" width=\"610\"><br>\nThis report will give you detailed information about the latency metric. You can examine the search and indexing latency separately, as well as the latency for the overall system which includes all operations to help identify if additional replicas are needed to support your increased query load.</p>\n\n<p>Remember that you can edit and modify the reports and dashboards to suit your needs, highlighting the data that is important to you. Stay tuned as we are working on an <a href=\"https://azure.microsoft.com/en-us/services/hdinsight/\">Azure HDInsight</a> sample that will be able to handle more advanced scenarios, such as very high data loads or more specific business questions.</p>\n\n<h2>Enabling search traffic analytics</h2>\n\n<p>To enable this feature, go to your Azure Search blade in the <a href=\"https://portal.azure.com/\">Azure Portal</a> and under Settings, you will find Search Traffic Analytics. Select the storage account you&rsquo;ll use to store the data and make sure to select Logs and Metrics. You will need a storage account in the same region as your search service. Standard costs apply for this storage account.</p>\n\n<p>Once enabled, the data will start flowing to your storage account within 5 to 10 minutes. The data is stored as JSON blobs in blob storage, and there will be one file per hour per container. You can find more information on how to enable Search Traffic Analytics and the full description of the logs and metrics schemas <a href=\"https://azure.microsoft.com/en-us/documentation/articles/search-traffic-analytics\">in the docs</a>.</p>\n\n<h2>Final thoughts</h2>\n\n<p>We encourage you to use all of this new available data, as we had very satisfied customers during our preview testing phase. We are confident that you will gain new information about your service that will help you provide a better experience for your users and obtain a much better grasp on how your search service is doing from an operational perspective. Thanks to this data, one of our customers found and fixed a bug in their indexing code and another one updated all their codepaths to the latest API version.</p>\n\n<p>We can&rsquo;t wait to know how this feature will help you. Connect it to your <a href=\"https://portal.azure.com/#create/Microsoft.Search\">Azure Search</a> service and <a href=\"https://feedback.azure.com/forums/263029-azure-search/\">let us know</a> what you think!</p>\n"
}