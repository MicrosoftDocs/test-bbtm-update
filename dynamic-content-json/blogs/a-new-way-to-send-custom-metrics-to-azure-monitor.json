{
    "Slug": "a-new-way-to-send-custom-metrics-to-azure-monitor",
    "Title": "A new way to send custom metrics to Azure Monitor",
    "Summary": "In todayâ€™s world of modern applications, metrics play a key role in helping you understand how your apps, services, and the infrastructure they run on, are performing. They can help you detect, investigate, and diagnose issues when they crop up. To provide you this level of visibility Azure has made resource-level platform metrics available via Azure Monitor.",
    "Content": "<p>In today&rsquo;s world of modern applications, metrics play a key role in helping you understand how your apps, services, and the infrastructure they run on, are performing. They can help you detect, investigate, and diagnose issues when they crop up. To provide you this level of visibility Azure has made <a href=\"https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-supported-metrics\">resource-level platform metrics</a> available via <a href=\"https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview\">Azure Monitor</a>. However, many of you need to collect more metrics, and unlock deeper insights about the resources and applications you are running in your hybrid environment.</p>\n\n<p>To accomplish this, you have already been able to send custom metrics from your apps via <a href=\"https://docs.microsoft.com/azure/application-insights/app-insights-overview\">Application Insights</a> SDKs. Today, we are happy to announce the public preview of custom metrics in Azure Monitor, now enabling you to submit metrics, collected anywhere, for any Azure resource. These metrics can be additional performance indicators, like Memory Utilization, about your resources; or business-related metrics emitted by your application, like page load times. As part of the <a href=\"https://aka.ms/AzureMonitor/FullStackMonitoring\">unified metric experience in Azure Monitor</a>, now you can:</p>\n\n<ul>\n <li>Send custom metrics with up to 10 dimensions</li>\n <li>Categorize and segregate metrics using namespaces</li>\n <li>Leverage a unified set of metrics and alerts experiences via Azure Monitor\n <ul>\n  <li>Plot custom metrics alongside your resources&rsquo; platform metrics in charts and dashboards on the Azure Portal</li>\n  <li>Access your custom metrics via the same set of <a href=\"https://docs.microsoft.com/rest/api/monitor/metrics/list\">REST APIs</a> as your platform metrics</li>\n  <li>Author and configure alert rules on any custom metric emitted to Azure Monitor; with added support to enable you to filter on any dimensions the metric has</li>\n </ul>\n </li>\n <li>Three months of retention of your custom metrics, preserved at 1-min granularity</li>\n</ul>\n\n<p>You can send your custom metrics to Azure Monitor in a few different ways:</p>\n\n<ul>\n <li>Send your metrics via our new <a href=\"https://docs.microsoft.com/en-us/rest/api/monitor/metrics%20(data%20plane)\">custom metrics REST API</a></li>\n <li>Publish metrics from your Windows VMs via the <a href=\"https://docs.microsoft.com/azure/monitoring-and-diagnostics/azure-diagnostics\">Windows Diagnostics Extension</a> (WAD)</li>\n <li>Publish metrics from your Linux VMs using the <a href=\"https://docs.influxdata.com/telegraf\">InfluxData Telegraf Agent</a></li>\n <li>Instrument your application using the <a href=\"https://docs.microsoft.com/azure/application-insights/app-insights-api-custom-events-metrics\">Application Insights SDK</a></li>\n</ul>\n\n<p>Read on to learn how you can get started on emitting your custom metrics to Azure Monitor.</p>\n\n<h2>Emit metrics from your Windows VMs</h2>\n\n<p>Many of you use the Azure Diagnostics Extensions (Windows and Linux) on Azure VMs and Classic Cloud Services to collect detailed guest OS level performance data. Previously, these diagnostics extensions allowed you to send the data to your Storage Tables and supported a limited set of metrics experiences on top of these guest-OS metrics.</p>\n\n<p>As part of today&rsquo;s release, we have upgraded the Windows Diagnostic Extension to have the option to send your performance counters directly to the Azure Monitor. This means you can chart, alert on, query, and filter on dimensions for Windows guest-OS metrics directly via the Azure Monitor experiences and REST APIs. We have published a walkthrough on how to <a href=\"https://aka.ms/VM/Windows-DiagExt-to-AzureMonitor\">install and configure the diagnostics extension</a>. Sending guest OS metrics to Azure Monitor using the Linux diagnostics extension is not available at this time but will be coming soon.</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0c7b2772-2bc9-4168-a10d-a2de073a8ddf.jpg\"><img alt=\"Azure%20Monitor%20-%20VM%20Guest%20and%20Platform%20Metrics\" border=\"0\" height=\"821\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3fa4face-8f47-422f-b3a6-1a5a674d72bd.jpg\" style=\"border: 0px currentcolor; border-image: none; margin-right: auto; margin-left: auto; float: none; display: block; background-image: none;\" title=\"Azure%20Monitor%20-%20VM%20Guest%20and%20Platform%20Metrics\" width=\"1406\"></a></p>\n\n<p align=\"center\"><em>A chart showing a guest OS metric (&lsquo;Memory/% Committed Bytes&rsquo;) and a platform metric (&lsquo;Percentage CPU&rsquo;) plotted side-by-side for a Windows Virtual Machine</em></p>\n\n<h2 align=\"left\">Emit metrics from your Linux VMs using InfluxData&rsquo;s Telegraf plugin agent</h2>\n\n<p>There&rsquo;s a rich ecosystem of open source monitoring tools that enable you to collect metrics for workloads running on Linux VMs. <a href=\"https://docs.influxdata.com/telegraf/v1.7/\">Telegraf,</a> is one such popular open-source agent. That is why we worked with our partners at <a href=\"https://www.influxdata.com/\">InfluxData</a>, the team behind this agent, to build an integration with Azure Monitor.</p>\n\n<p>Telegraf is an open-source plugin-driven agent that enables the collection of metrics from over 150 different sources (depending on what&rsquo;s running on your VM). Most of these plugins are contributed by the community which means you can expect even more collector agents to become available in the coming months. Output plugins, then enable the agent to write to destinations of your choosing. The agent integrated directly with our custom metrics REST API, and now supports a brand new &ldquo;Azure Monitor Output plugin&rdquo;. This enables you to install the Telegraf agent and collect metrics about the workloads (ex. MySQL, NGINX etc.) running on your Linux VM and have them published to Azure Monitor as custom metrics. Here is a <a href=\"https://aka.ms/AzureMonitor/Telegraf-to-AzureMonitor\">quick walkthrough</a> on how to set this up yourself!</p>\n\n<h2>Unified experience for Application Insights SDK emitted metrics</h2>\n\n<p>As part of Application Insights, you&rsquo;ve always had the ability to use the Application Insights SDK to instrument your code to collect insights about your application and emit these as custom metrics. From there you were able to alert on these metrics and plot charts with the ability to split and filter on dimensions. Today we are enabling you to alert on dimensions as well; this is automatically available for all standard metrics emitted by Application Insights. To enable alerting on dimensions for your custom metrics there is a <a href=\"https://aka.ms/AppInsights/DimensionalAlerting\">simple opt-in experience</a> for your Application Insights component.</p>\n\n<h2>Pricing</h2>\n\n<p>All resource-level platform metrics will continue to be available to you for free. Custom metrics emitted against Azure resources will be metered. Custom metrics will be free for the first 150MB per month, after which they will be subject to metering based on the volume of data ingested.</p>\n\n<p>Application Insights customers will continue to be metered based on the current Application Insights pricing model with no changes. Enabling dimensional alerting on custom metrics is completely optional, opting into this feature will be subject to custom metrics metering.</p>\n\n<p>More information on the <a href=\"https://azure.microsoft.com/pricing/details/monitor/\">pricing of these features can be found here</a>.</p>\n\n<h2>Wrapping up</h2>\n\n<p>Azure already gives you visibility into how your resources are performing with platform metrics via Azure Monitor. Now, you can supplement these metrics by emitting your own custom metrics about your applications and resources to Azure Monitor. We are excited about this initial release and in the coming months will continue to make this available in more Azure regions, add more features, and enable other capabilities across Azure Monitor to take advantage of custom metrics. We would love to hear from you as you try this out; drop us a comment, or head over to <a href=\"https://feedback.azure.com/forums/231545-diagnostics-and-monitoring\">User Voice</a> to let us know what you think!</p>\n"
}