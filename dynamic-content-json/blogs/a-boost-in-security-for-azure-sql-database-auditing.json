{
    "Slug": "a-boost-in-security-for-azure-sql-database-auditing",
    "Title": "A Boost in Security for Azure SQL Database: Auditing",
    "Summary": "Auditing feature is now available for Azure SQL DB, in a preview offering. This is a key security enhancement that removes barriers from businesses wanting to manage their databases in the cloud.",
    "Content": "<p>Our customers have spoken and we&rsquo;ve been listening: the much-anticipated Auditing feature is now available for Azure SQL DB, in a preview offering. This is a key security enhancement that removes barriers from businesses wanting to manage their databases in the cloud. Introduced to preview a couple of weeks ago, SQL Database Auditing increases an organization&rsquo;s ability to gain deep insight into events and changes that occur within the database, including updates and queries against the data. Using a very simple and intuitive configuration interface, you can now have Auditing up and running on your database within minutes.</p>\n\n<p>Check out a demo and learn more about the benefits of Auditing in this lively and informative <a href=\"https://channel9.msdn.com/Shows/Data-Exposed/Auditing-in-Azure-SQL-Database\">Channel 9 video</a> in which Eyal Carmel and Scott Klein discuss this new capability. Auditing is available for all Basic, Standard and Premium databases, and configurable via the new <a href=\"https://portal.azure.com/\">Azure Preview Portal</a> or via standard APIs. For updated information on how to set up Auditing for your database, please see <a href=\"https://azure.microsoft.com/en-us/documentation/articles/sql-database-auditing-get-started/\">Getting Started with SQL database auditing</a>.</p>\n\n<h1>Why do I need Auditing?</h1>\n\n<p>With auditing enabled on your database, you immediately have a repository of valuable data that can serve a variety of objectives.</p>\n\n<ul>\n <li><strong>Streamline compliance-related activities</strong></li>\n</ul>\n\n<blockquote>Auditing is a valuable tool that can be used to help organizations meet various industry compliance requirements and regulations, such as PCI-DSS, SOX or HIPAA. Many such regulations require an audit trail on data-related activities against the underlying databases.</blockquote>\n\n<ul>\n <li><strong>Gain Insight about database activity</strong></li>\n</ul>\n\n<blockquote>Retaining an audit trail means that you now know exactly <i>what activity</i> is taking place on your database, <i>by whom</i> and <i>when</i>. This can readily be used to enhance business visibility; such data can help to identify business trends or potentially indicate business concerns. For instance, an analysis of the data may identify a drop in activity levels over time in a database located in a particular geographic location, which can then be addressed by the business.</blockquote>\n\n<ul>\n <li><strong>Identify suspected security violations</strong></li>\n</ul>\n\n<blockquote>An analysis of audit data can expose discrepancies and anomalies in data-related activities across the organization. This can lead to the identification of potential security incidents.</blockquote>\n\n<p>It is important to call out that while Auditing and other security features can make it easier to build applications that meet regulatory compliances, they cannot guarantee compliance. It remains the organization&rsquo;s responsibility to ensure the application design and database practices are implemented to adhere to the required corporate or industry security and compliance standards.</p>\n\n<h1>How does Auditing track events against my SQL Database?</h1>\n\n<p>Once enabled and configured, the Auditing engine tracks all incoming and outgoing events from the designated SQL Database.&nbsp; You can configure categories of database actions and events to be logged, and each relevant event is written to the audit log in Azure Storage. Note that the &lsquo;user&rsquo; (or principal) referenced in each audit entry is the database user logged in to the SQL database &ndash; not necessarily the application user.</p>\n\n<h1>What data is actually being logged? Where is that data stored?</h1>\n\n<p>When configuring Auditing, you specify an Azure Storage account to which your audit logs will be written (Note that Azure Storage rates apply). Once Auditing has been enabled, an Azure Table is automatically created on that designated storage account, and records for selected events (based on what you configured) are written to that table. See the illustration below of the Auditing architecture. The Audit entries written conform to a schema with predefined fields; the <a href=\"https://go.microsoft.com/fwlink/?LinkId=506733\">detailed specification</a> for this schema can be downloaded <a href=\"https://go.microsoft.com/fwlink/?LinkId=506732\">here</a>.</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/audit-p1.png\"><img alt=\"audit p1\" border=\"0\" height=\"428\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/audit-p1_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;\" title=\"audit p1\" width=\"559\"></a></blockquote>\n\n<p>Since the audit logs are written directly to your Azure Storage account, access to this data is entirely in your control. To view the logs, you can connect to the Azure Storage account via your tool of choice, such as <a href=\"https://azurestorageexplorer.codeplex.com/\">Azure Storage Explorer</a>, or via our pre-defined <a href=\"https://go.microsoft.com/fwlink/?LinkId=403540\">Excel dashboard and reports template</a>, which can retrieve the logs from your Azure Storage Account using PowerQuery. The Power Query for Excel add-in is available as a free <a href=\"https://www.microsoft.com/en-us/download/details.aspx?id=39379\">download</a> to all Office 2013 customers.</p>\n\n<h1>How do I set up Auditing for my SQL DB?</h1>\n\n<p>You can configure Auditing for your database with a few simple steps, using an intuitive configuration interface in the Azure preview portal, shown below. You need to start with a Basic, Standard or Premium database to set up Auditing. Navigate to the target database in the <a href=\"https://portal.azure.com/\">Azure preview portal</a>, and click on <strong>Enable and Setup Auditing</strong> to launch the Auditing configuration blade. Select an Azure Storage Account where your audit logs will be saved and specify the set of events that you wish to log.</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/audit-p2.png\"><img alt=\"audit p2\" class=\"alignnone size-medium wp-image-176991\" height=\"369\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/audit-p2-146x369.png\" style=\"width: 150px; height: 308px;\" width=\"146\"></a></blockquote>\n\n<p>Once you&rsquo;ve configured the Auditing settings, you need to update existing client applications connecting to the database to use the Security Enabled Connection Strings. This will enable the activity of these applications on the database to be logged. <strong>Security Enabled Connection Strings</strong> have a slightly different format, and replace the previously used connection strings:</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/clip_image001.png\"><img alt=\"clip_image001\" border=\"0\" height=\"134\" hspace=\"24\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/clip_image001_thumb.png\" style=\"border-width: 0px; padding-top: 0px; padding-right: 0px; padding-left: 0px;\" title=\"clip_image001\" vspace=\"24\" width=\"626\"></a></blockquote>\n\n<p>Once Auditing is set up and working, you can view the Auditing dashboard shown below, which provides a quick at-a-glance view of database activity directly from the Azure portal. It displays an updated count of audited database events (freshness up to 15 minutes), that occurred within the past 24 hours. It also shows a breakdown of events by type, so that you can quickly understand the distribution of events occurring on your database, and also identify any unusual or unexpected activity.</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/audit-p3.png\"><img alt=\"audit p3\" class=\"alignnone size-medium wp-image-177011\" height=\"369\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/audit-p3-636x369.png\" width=\"636\"></a></blockquote>\n\n<h1>&nbsp;</h1>\n\n<h1>I want to Audit all of my databases &ndash; can I set up Auditing for several SQL DBs at once?</h1>\n\n<p>A single Auditing policy can be conveniently defined for all the databases within a particular database server. This is done by designating a policy as the <strong>default policy</strong> for that server. In order to create such a policy, you should configure Auditing for one of the databases on that server, and then click on <strong>Save as default</strong> to automatically apply these same settings to all databases on the DB server that do not already have an explicit auditing configuration defined. This particular configuration workflow is shown below.</p>\n\n<blockquote><a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/audit-p4.png\"><img alt=\"audit p4\" class=\"alignnone size-medium wp-image-177013\" height=\"369\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/audit-p4-196x369.png\" width=\"196\"></a></blockquote>\n\n<p>The ability to create a default setting for all databases on a server will soon be available from the DB server context as well.</p>\n\n<h1>&nbsp;</h1>\n\n<h1>Now that I&rsquo;m gathering data on activities in my databases, how do I analyze it?</h1>\n\n<p>You can analyze the audit logs using the application of your choice, by exporting the audit records from Azure Storage as a CSV-formatted file (other file formats are available as well). We also provide a pre-baked analysis tool for your audit data, in the form of an interactive <a href=\"https://go.microsoft.com/fwlink/?LinkId=403540\">Excel template with predefined dashboards and reports</a>. You can retrieve the audit logs data directly from Azure storage using the Power Query for Excel add-in. The reports will automatically be updated to reflect your database activity based on the loaded audit logs from the Storage account. See detailed instructions for attaching the reports template to your audit logs storage, and for using the built-in analysis templates in the Instructions document for working with the <a href=\"https://go.microsoft.com/fwlink/?LinkId=403540\">Excel template</a>. When multiple databases are being audited (to the same Storage Account), you can use the built-in reports to compare activity and trends between databases, and discover anomalies. The reports themselves are interactive; using Power View and Power Pivot to visualize the data, you can slice the views according to database, event type, timeframes, etc. The reports are also customizable and extendable. If desired, you can create additional reports and views to align with your organization&rsquo;s requirements. Sample reports are shown below.</p>\n\n<blockquote>&nbsp;<a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/audit-p5.jpg\"><img alt=\"audit p5\" class=\"alignnone size-medium wp-image-177031\" height=\"369\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/audit-p5-508x369.jpg\" width=\"508\"></a> <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/audit-p6.png\"><img alt=\"audit p6\" class=\"alignnone size-medium wp-image-177041\" height=\"369\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/audit-p6-457x369.png\" width=\"457\"></a> <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/image.png\">&nbsp;</a> <a href=\"https://acom.azurecomcdn.net/80C57D/blogmedia/blogmedia/2014/08/image.png\">&nbsp;</a></blockquote>\n\n<h1>Summary</h1>\n\n<p>Auditing provides a layer of security for your Azure SQL Database, by tracking and logging events and database activity. The audit data can be used to gain insights into database activity, identify potential security concerns and ensure that a record exists for any suspected violations, and to facilitate and streamline compliance-related tasks. Learn more about <a href=\"https://azure.microsoft.com/en-us/documentation/articles/sql-database-auditing-get-started/\">getting started with Auditing</a>, or take a few minutes to watch <a href=\"https://channel9.msdn.com/Shows/Data-Exposed/Auditing-in-Azure-SQL-Database\">Eyal and Scott on Channel 9</a> discussing the benefits of Auditing and how simple it is to set up. You can get started right away with the Auditing feature but will need to use a Basic, Standard or Premium database (<a href=\"https://azure.microsoft.com/en-us/services/preview/\">sign up for the preview of the new service tiers</a>, if you haven&rsquo;t done so yet), and then <a href=\"https://account.windowsazure.com/PreviewFeatures?fid=datasecurity\">sign up for the Auditing preview</a>. You can configure Auditing for your database in the <a href=\"https://portal.azure.com/\">Azure Preview Portal</a>. We&rsquo;re listening closely to feedback so please try it out and let us know what you think!</p>\n"
}