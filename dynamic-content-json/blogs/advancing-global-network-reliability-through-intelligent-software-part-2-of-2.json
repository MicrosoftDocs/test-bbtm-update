{
    "Slug": "advancing-global-network-reliability-through-intelligent-software-part-2-of-2",
    "Title": "Advancing global network reliability through intelligent software—part 2 of 2",
    "Summary": "In our two-part series on advancing global network reliability through intelligent software, we explain how we’ve approached our network design, and how we’re constantly working to improve both reliability and performance.",
    "Content": "<p><i>&ldquo;Microsoft&rsquo;s global network connects over 60 Azure regions, over 220 Azure data centers, over 170 edge sites, and spans the globe with more than 165,000 miles of terrestrial and subsea fiber. The global network connects to the rest of the internet via peering at our strategically placed edge points of presence (PoPs) around the world. Every day, millions of people around the globe access Microsoft Azure, Office 365, Dynamics 365, Xbox, Bing and many other Microsoft cloud services. This translates to trillions of requests per day and terabytes of data transferred each second on our global network. It goes without saying that the reliability of this global network is critical, so I&rsquo;ve asked Principal Program Manager <b>Mahesh Nayak</b> and Principal Software Engineer <b>Umesh</b> <b>Krishnaswamy </b>to write this two-part post in our <a href=\"https://www.aka.ms/AdvancingReliability\" target=\"_blank\">Advancing Reliability series</a>. They explain how we&rsquo;ve approached our network design, and how we&rsquo;re constantly working to improve both reliability and performance.&rdquo;&mdash;</i>Mark Russinovich, CTO, Azure</p>\n\n<hr>\n<p><i>Read <a href=\"https://azure.microsoft.com/en-us/blog/advancing-global-network-reliability-through-intelligent-software-part-1-of-2/\" target=\"_blank\">Advancing global network reliability through intelligent software part 1</a>.</i></p>\n\n<p>In part one of this networking post, we presented the key design principles of our global network, explored how we emulate changes, our zero touch operations and change automation, and capacity planning. In part two, we start with traffic management. For a large-scale network like ours, it would not be efficient to use traditional hardware managed traffic routing. Instead, we have developed several software-based solutions to intelligently manage traffic engineering in our global network.</p>\n\n<h4>&nbsp;</h4>\n\n<h2>SDN-based Internet Traffic Engineering (ITE)</h2>\n\n<p>The edge is the most dynamic part of the global network&mdash;because the edge is how users connect to Microsoft&rsquo;s services. We have strategically deployed edge PoPs close to users, to improve customer/network latency and extend the reach of Microsoft cloud services.</p>\n\n<p>For example, if a user in Sydney, Australia accesses Azure resources hosted in Chicago, USA their traffic enters the Microsoft network at an edge PoP in Sydney then travels on our network to the service hosted in Chicago. The return traffic from Azure in Chicago flows back to Sydney on our Microsoft network. By accepting and delivering the traffic to the point closest to the user, we can better control the performance.</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/0d0fe7d2-f92c-4707-b19b-36f9cc81236f.jpg\"><img alt=\"Azure Edge premium routing.\" border=\"0\" height=\"258\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/f6a8b6c5-2f2b-4482-a686-128067a19cd5.jpg\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"Azure Edge premium routing.\" width=\"1248\"></a></p>\n\n<p>Each edge PoP is connected to tens or hundreds of peering networks. Routes between our network and providers&rsquo; networks are exchanged using the Border Gateway Protocol (BGP). BGP best path selection has no inherent concept of congestion or performance&mdash;neither is BGP capacity aware. So, we developed an SDN-based Internet Traffic Engineering (ITE) system that steers traffic at the edge. The entry and exit points are dynamically altered based on the traffic load of the edge, internet partners&rsquo; capacity constraints, reduction or augments in capacity, demand spikes sometimes caused by distributed denial of service attacks, and latency performance of our internet partners. The ITE controller constantly monitors these signals and alters the routes we advertise to our internet partners and/or the routes advertised inside the Microsoft network, to select the best peer-edge.</p>\n\n<h2>Optimizing last mile resilience with Azure Peering Service</h2>\n\n<p>In addition to optimizing routes within our global network, the <a href=\"https://docs.microsoft.com/en-us/azure/peering-service/about\" target=\"_blank\">Azure Peering Service</a> extends the optimized connectivity to the last mile in the networks of Internet Service Providers (ISPs). Azure Peering Service is a collaboration platform with providers, to enable reliable high-performing connectivity from the users to the Microsoft network. The partnership ensures local and geo redundancy, and proximity to the end users. Each peering location is provisioned with redundant and diverse peering links. Also, providers interconnect at multiple Microsoft PoP locations so that if one of the edge nodes has degraded performance, the traffic routes to and from Microsoft via alternative sites. Internet performance telemetries from Map of Internet (MOI) drive traffic steering for optimized last mile performance.</p>\n\n<h2>Route Anomaly Detection and Remediation (RADAR)</h2>\n\n<p>The internet runs on BGP. A network or autonomous system is bound to trust, accept, and propagate the routes advertised by its peers without questioning its provenance. That is the strength of BGP and allows the internet to update quickly and heal failures. But it is also its weakness&mdash;the path to prefixes owned by a network can be changed by accident or malicious intent to redirect, intercept, or blackhole traffic. There are several incidents that happen to every major provider and some make front page news. We developed a global Route Anomaly Detection and Remediation (RADAR) system to protect our global network.</p>\n\n<p>RADAR detects and mitigates Microsoft route hijacks on the Internet. BGP route leak is the propagation of routing announcement(s) beyond their intended scope. RADAR detects route leaks in Azure and the internet. It can identify stable versus unstable versions of a route and validate new announcements. Using RADAR, and the ITE controller, we built real-time protection for Microsoft prefixes. Peering Service platform extends the route monitoring and protection against hijacks, leaks and any other BGP misconfiguration (intended or not) in the last mile up to the customer location.</p>\n\n<h2>Software-driven Wide Area Network (SWAN)</h2>\n\n<p>The backbone of the global network is analogous to a highway system connecting major cities. The SWAN controller is effectively the navigation system that assigns the routes for each vehicle, such that every vehicle reaches its destination as soon as possible and without causing congestion on the highways. The system consists of topology discovery, demand prediction, path computation, optimization, and route programming.</p>\n\n<p><a href=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/b8a68c48-2ec6-4645-97ca-c867e6812731.png\"><img alt=\"Optimized risk diverse path computation.\" border=\"0\" height=\"312\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5ed23a83-6aa9-4f9b-8af7-1fc0743f8b7b.png\" style=\"border: 0px currentcolor; border-image: none; display: inline; background-image: none;\" title=\"Optimized risk diverse path computation.\" width=\"624\"></a></p>\n\n<p>Over the last 12 months, the speed of the controller to program the network improved by an order of magnitude and the route-finding capability improved two-fold. Link failures are like lane closures so the controller must recompute routes to decrease congestion. The controller uses the same shared risk link groups (SRLGs) to compute backup routes in case of failure of the primary routes. The backup routes activate immediately upon failure, and the controller gets to work at reoptimizing traffic placement. Links that go up and down in rapid succession are held back from service until they stabilize.</p>\n\n<p>One measure of reliability is the percentage of successfully transmitted bytes to requested bytes, measured over an hour and averaged for the day. Ours is 99.999 percent or better for customer workloads. All communication between Microsoft services is through our dedicated global network. <a href=\"https://marketo-web.thousandeyes.com/rs/thousandeyes/images/ThousandEyes-Cloud-Performance-Benchmark-2019-2020-Edition.pdf\" target=\"_blank\">Thousand Eyes Cloud Performance Benchmark</a> reports that over 99 percent of Azure inter-region latencies faster than the performance baseline, and over 60 percent of region pairs are at least 10 percent faster. This is a result of the capacity augments and software systems described in this post.</p>\n\n<h2>Bandwidth Broker&mdash;software-driven Network Quality of Service (QoS)</h2>\n\n<p>If the global network is a highway system, Bandwidth Broker is the system that controls the metering lights at the onramps of highways. For every customer vehicle, there is more than one Microsoft vehicle traversing the highway. Some of the Microsoft vehicles are discretionary and can be deferred to avoid congestion for customer vehicles. Customer vehicles always have a free pass to enter the highways. The metering lights are green in normal operation but when there is a failure or a demand spike, Bandwidth Broker turns on the metering lights in a controlled manner. Microsoft internal workloads are divided into traffic tiers, each with a different priority. Higher priority workloads are admitted in preference to lower priority workloads.</p>\n\n<p>Brokering occurs at the sending host. Hosts periodically request bandwidth on behalf of applications running on them. The requests are aggregated by the controller, bandwidth is reserved, and grants are disseminated to each host. Bandwidth Broker and SWAN coordinate to adjust traffic volume to match routes, and traffic routes to match volume.</p>\n\n<p>It is possible to experience multiple fiber cuts or failures that suddenly reduce network capacity. Geo-replication operations to increase resilience can cause a huge surge in network traffic. Bandwidth Broker generally allows us to preserve the customer experience during these conditions, by shedding discretionary internal workloads when congestion was imminent.</p>\n\n<h2>Continuous monitoring</h2>\n\n<p>A robust monitoring solution is the foundation to achieve higher network reliability. It lowers both the time to detect and time to repair. The monitoring pipelines constantly analyze several telemetry streams including traffic statistics, health signals, logs, and device configurations. The pipelines automatically collect more data when anomalies are detected or diagnose and remediate common failures. These automated interventions are also guarded by safety check systems.</p>\n\n<p>Major investments in monitoring have been:</p>\n\n<ul>\n\t<li>Polling and ingestion of metrics data at sub-minute speeds. A few samples are needed to filter transients and a few more to generate a strong signal. This leads to faster detection times.</li>\n\t<li>An enhanced diagnostics system that is triggered by packet loss or latency alerts, instructs agents at different vantage points to collect additional information to help triangulate and pinpoint the issue to a specific link or device.</li>\n\t<li>Enhanced diagnostics trigger auto-mitigation and remediation actions for the most common incidents, with the help of Clockwerk and Real Time Operation Checker (ROC). This translates to faster time to repair and has the ripple effect of keeping engineers focused on more complex incidents.</li>\n</ul>\n\n<p>Other pipelines continuously monitor network graphs for node isolation, and periodically assess risks with &ldquo;what-if&rdquo; intent using ROC as described above. We have multiple canary agents deployed throughout the network checking reachability, latency, and packet loss across our regions. This includes agents within Azure, as well as outside of our network, to enable outside-in monitoring. We also periodically analyze Map of Internet (MOI) telemetries to measure end to end performance from customers to Azure. Finally, we have robust monitoring in place to protect the network from security attacks such as BGP route hijacks, and distributed denial of service (DDoS).</p>\n\n<h2>Conclusion</h2>\n\n<p>We have open-sourced some of these SDN technologies such as <u><a href=\"https://github.com/Azure/SONiC/wiki\" target=\"_blank\">SONIC</a></u>. SONIC and its rapidly growing ecosystem of hardware and software partners enables intelligent new ways to operate and manage the network, and faster evolution of the network itself. Also, we have built services such as <u><a href=\"https://docs.microsoft.com/en-us/azure/expressroute/expressroute-global-reach\" target=\"_blank\">ExpressRoute Global Reach</a>,</u> <u><a href=\"https://azure.microsoft.com/en-us/services/virtual-wan/\" target=\"_blank\">Azure Virtual WAN</a>,</u> <u><a href=\"https://azure.microsoft.com/en-us/updates/global-vnet-peering-general-availability/\" target=\"_blank\">Global VNET Peering</a></u>, and <u><a href=\"https://docs.microsoft.com/en-us/azure/peering-service/about\" target=\"_blank\">Azure Peering Service</a></u> that empowers you to build your own overlay on top of the Microsoft global network.</p>\n\n<p>We are continually investing in and enhancing our global network resilience with software and hardware innovations. Our optical fiber investments have improved resilience, performance, and reliability both within and across continents. The <a href=\"https://news.microsoft.com/marea/\" target=\"_blank\">MAREA</a> submarine cable system is the industry&rsquo;s first subsea Open Line System (OLS). It has become a blueprint for all subsequent submarine cable builds which are now following the OLS construct. The ability to upgrade these systems more easily and maintain a homogenous platform across all parts of our network allows Microsoft to seamlessly keep pace with growing demand.</p>\n\n<p><i>Read <a href=\"https://azure.microsoft.com/en-us/blog/advancing-global-network-reliability-through-intelligent-software-part-1-of-2/\" target=\"_blank\">Advancing global network reliability through intelligent software part 1</a>.</i></p>\n"
}