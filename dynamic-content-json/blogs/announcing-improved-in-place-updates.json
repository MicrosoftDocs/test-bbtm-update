{
    "Slug": "announcing-improved-in-place-updates",
    "Title": "Announcing Improved In-place Updates",
    "Summary": "  Based on your feedback, today we are making some helpful updates to Windows Azure that provide developers flexibility for making in-place updates to deployed services. Best of all, these updatesâ€¦",
    "Content": "<div>  <p>Based on your feedback, today we are making some helpful updates to <a target=\"_blank\" href=\"https://azure.microsoft.com/\">Windows Azure</a> that provide developers flexibility for making in-place updates to deployed services. Best of all, these updates are easily made without changing the public IP of the service.</p>  </div>  <p>Windows Azure now supports a wider range of changes to a deployed service without requiring the use of a VIP swap or a complete delete and re-deploy of the service. With the following changes permitted through an in-place update, you will now be allowed to make almost all possible updates without requiring a VIP swap or a re-deploy!</p>  <p>The newly allowed in-place updates are:</p>  <ul>  <li>Change the virtual machine size (scale-up or scale-down)</li>  <li>Increase local storage</li>  <li>Add or remove roles to a deployment</li>  <li>Change the number or type of endpoints</li>  </ul>  <h4>Summary of changes allowed</h4>  <table rules=\"all\" style=\"border-color: #000000; border-width: 0pt; border-style: solid; width: 585px; height: 738px;\" frame=\"border\" border=\"0\" cellpadding=\"2\" cellspacing=\"0\">  <thead>  <tr>  <td valign=\"top\" width=\"124\">  <p><b>Changes permitted to hosting, services, and roles</b></p>  </td>  <td valign=\"top\" width=\"138\">  <p><b>In-place update</b></p>  </td>  <td valign=\"top\" width=\"107\">  <p><b>Staged (VIP swap)</b></p>  </td>  <td valign=\"top\" width=\"107\">  <p><b>Delete and </b></p>  <p><b>re-deploy</b></p>  </td>  </tr>  </thead>  <tbody>  <tr>  <td valign=\"top\" width=\"124\">  <p>Operating system version</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>.NET trust level</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Virtual machine size</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  <p class=\"alertlabel\">Warning</p>  <p class=\"alerttext\">Changing virtual machine size will destroy local data. When making this change using the service management APIs, <a href=\"https://msdn.microsoft.com/en-us/library/ee460793.aspx\">the force flag is required</a></p>  <p class=\"alertlabel\">Note</p>  <p class=\"alerttext\">Requires Windows Azure SDK 1.5 or later</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Local storage settings</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  <p>Increase only.</p>  <p class=\"alertlabel\">Note</p>  <p class=\"alerttext\">Requires Windows Azure SDK 1.5 or later</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Add or remove roles in a service</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Number of instances of a particular role</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Number or type of endpoints for a service</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  <p class=\"alertlabel\">Note</p>  <p>Requires Windows Azure SDK 1.5 or later.</p>  <p>&nbsp;</p>  <p class=\"alertlabel\">Note</p>  <p class=\"alerttext\">Availability may be temporarily lost as endpoints are updated</p>  </td>  <td valign=\"top\" width=\"107\">  <p>No</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Names and values of configuration settings</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Values (but not names) of configuration settings</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Add new certificates</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Change existing certificates</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"124\">  <p>Deploy new code</p>  </td>  <td valign=\"top\" width=\"138\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  <td valign=\"top\" width=\"107\">  <p>Yes</p>  </td>  </tr>  </tbody>  </table>  <h4>&nbsp;</h4>  <h4>Changing Virtual Machine Size example</h4>  <p>The following example shows how to change the virtual machine size through the Windows Azure portal.</p>  <p style=\"text-align: left;\" align=\"center\"><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2158.InPlace1.png\" alt=\"\" border=\"0\"></p>  <p align=\"center\">  <p align=\"center\"><i>Figure 1: Initial state of the deployment</i></p>  <p>When attempting to change the size of the VM without checking the box for &ldquo;Allow VM size or role count to be updated&rdquo; the following error will be shown:</p>  <p style=\"text-align: center;\" align=\"center\"><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5102.InPlace2.png\" alt=\"\" border=\"0\"></p>  <p style=\"text-align: center;\" align=\"center\"><i>Figure 2: Error message when attempting to change role count</i></p>  <p>Now when the same operation is attempted with the &ldquo;Allow VM size or role count to be updated&rdquo; checkbox checked the VM size will be updated:</p>  <p style=\"text-align: center;\" align=\"center\"><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3858.InPlace3.png\" alt=\"\" border=\"0\"></p>  <p align=\"center\"><i>Figure 3: Update with the checkbox checked</i></p>  <p>&nbsp;<img style=\"display: block; margin-left: auto; margin-right: auto;\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/2110.InPlace4.png\" alt=\"\" border=\"0\"></p>  <p style=\"text-align: center;\" align=\"center\"><i>Figure 4: Deployment after update has completed</i></p>  <h4>More Control over in-place updates</h4>  <p>In addition to the wider applicability of an in-place update, you now have greater control over the update process itself by being able to rollback an update that is in progress or even starting a second update. While an update is in progress (defined by at least one instance of the service not yet updated to the new version) you can roll back the update by using the <a href=\"https://msdn.microsoft.com/en-us/library/hh403977.aspx\" target=\"_blank\">Rollback Update Or Upgrade</a> operation.</p>  <p>If the rollback operation is specified to be in automatic mode, the rollback will begin immediately in the first upgrade domain without waiting for all instances in the upgrade domain that is currently offline to return to the Ready state. To prevent multiple upgrade domains from being offline simultaneously the rollback can be done in manual mode. In manual mode the first upgrade domain will not be rolled back until <a href=\"https://msdn.microsoft.com/en-us/library/ee460800.aspx\" target=\"_blank\">Walk Upgrade Domain</a> is called for the first upgrade domain.</p>  <h4>Multiple Update Operations</h4>  <p>Initiating a second update operation while the first update is ongoing will perform similar to the rollback operation. If the second update is in automatic mode, the first upgrade domain will be upgraded immediately, possibly leading to instances from multiple upgrade domains being offline at the same point in time. Further details on using the rollback operation or initiating multiple mutating operations can be found here.</p>  <h4>Summary of Update Options</h4>  <p>Now that most modification can be performed using any of the three options for updating a hosted service, it is worth taking some time to describe when each option is most appropriate. This is best described by the following table of advantages and disadvantages:</p>  <table rules=\"all\" style=\"border-color: #000000; border-width: 0pt; border-style: solid; width: 543px; height: 412px;\" frame=\"border\" border=\"0\" cellpadding=\"5\" cellspacing=\"0\">  <thead>  <tr>  <td valign=\"top\" width=\"90\">  <p><b>Update option</b></p>  </td>  <td valign=\"top\" width=\"140\">  <p><b>Description</b></p>  </td>  <td valign=\"top\" width=\"113\">  <p><b>Advantages</b></p>  </td>  <td valign=\"top\" width=\"135\">  <p><b>Disadvantages</b></p>  </td>  </tr>  </thead>  <tbody>  <tr>  <td valign=\"top\" width=\"90\">  <p><a href=\"https://msdn.microsoft.com/en-us/library/ee517255.aspx\" target=\"_blank\">In-place update</a></p>  </td>  <td valign=\"top\" width=\"140\">  <p>The new package is uploaded and applied to the running instances of the service.</p>  </td>  <td valign=\"top\" width=\"113\">  <p>Only a single running deployment is required.</p>  <p>&nbsp;</p>  <p>Service availability can be maintained as long as there are at least two instances for each role.</p>  </td>  <td valign=\"top\" width=\"135\">  <p>Service capacity is limited while instances are brought down, updated and then restarted.</p>  <p>  <p>Service code must be able to support multiple versions of the code running on different instances as the instances are updated</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"90\">  <p><a href=\"https://msdn.microsoft.com/en-us/library/windowsazure/ee517253.aspx\" target=\"_blank\">Staged (VIP swap)</a></p>  </td>  <td valign=\"top\" width=\"140\">  <p>Upload the new package and swap it with the existing production version. This is referred to as a VIP swap because it simply swaps the visible IP addresses of the services.&nbsp;</p>  </td>  <td valign=\"top\" width=\"113\">  <p>No service downtime or loss of capacity.</p>  </td>  <td valign=\"top\" width=\"135\">  <p>Two deployments are required to be running at least during the update.</p>  </td>  </tr>  <tr>  <td valign=\"top\" width=\"90\">  <p>Redeploy the service</p>  </td>  <td valign=\"top\" width=\"140\">  <p>Suspend and then delete the service, and then deploy the new version.</p>  </td>  <td valign=\"top\" width=\"113\">  <p>Only a single running deployment is required.</p>  </td>  <td valign=\"top\" width=\"135\">  <p>Service will be down between deleting the service and redeploying the service.</p>  <p>&nbsp;</p>  <p>Virtual IP (VIP) will often change when the service is redeployed.</p>  </td>  </tr>  </tbody>  </table>  <p>Further details on updating a Windows Azure service can be found here.&nbsp;</p>"
}