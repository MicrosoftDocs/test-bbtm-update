{
    "Slug": "announcing-new-system-views-for-windows-azure-sql-database",
    "Title": "Announcing: New System Views for Windows Azure SQL Database",
    "Summary": "We are happy to announce the immediate availability of two new system views for Windows Azure SQL Database that provide diagnostic tracking information for your cloud databases.&nbsp;  Within theâ€¦",
    "Content": "<p>We are happy to announce the immediate availability of two new system views for Windows Azure SQL Database that provide diagnostic tracking information for your cloud databases.&nbsp;</p>  <p>Within the <strong>master</strong> database of your SQL Database server(s), you now have the following new&nbsp;system views&nbsp;available:</p>  <table class=\"MsoNormalTable\" style=\"border-collapse: collapse; mso-yfti-tbllook: 1184; mso-padding-alt: 0in 0in 0in 0in;\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">  <tbody>  <tr>  <td style=\"width: 159.6pt; border: solid windowtext 1.0pt; background: #D9D9D9; mso-background-themecolor: background1; mso-background-themeshade: 217; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"160\">  <p class=\"MsoNormal\"><strong>View</strong></p>  </td>  <td style=\"width: 159.6pt; border: solid windowtext 1.0pt; border-left: none; background: #D9D9D9; mso-background-themecolor: background1; mso-background-themeshade: 217; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"160\">  <p class=\"MsoNormal\"><strong>Location</strong></p>  </td>  <td style=\"width: 350.9pt; border: solid windowtext 1.0pt; border-left: none; background: #D9D9D9; mso-background-themecolor: background1; mso-background-themeshade: 217; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"351\">  <p class=\"MsoNormal\"><strong>Detail</strong></p>  </td>  </tr>  <tr>  <td style=\"width: 159.6pt; border: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"160\">  <p class=\"MsoNormal\">sys.event_log</p>  </td>  <td style=\"width: 159.6pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"160\">  <p class=\"MsoNormal\">master</p>  </td>  <td style=\"width: 350.9pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"351\">  <p class=\"MsoNormal\">Exposes log information from the system to the customer about each database hosted in that server.</p>  </td>  </tr>  <tr>  <td style=\"width: 159.6pt; border: solid windowtext 1.0pt; border-top: none; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"160\">  <p class=\"MsoNormal\">sys.database_connection_stats</p>  </td>  <td style=\"width: 159.6pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"160\">  <p class=\"MsoNormal\">master</p>  </td>  <td style=\"width: 350.9pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0in 5.4pt 0in 5.4pt;\" valign=\"top\" width=\"351\">  <p class=\"MsoNormal\">Exposes connection statistics details around connection successes and failures.&nbsp;</p>  </td>  </tr>  </tbody>  </table>  <p>With this improvement, system administrators can now query for connection statistics and throttling events with the same tools and techniques that they use with on-premises SQL Server using system views designed for the cloud.</p>  <h4>The sys.event_log View</h4>  <p>At this time, the sys.event_log view enables the following key scenarios:</p>  <ul>  <li>  <p>Exposing connection statistics information</p>  </li>  <li>  <p>Exposing deadlock graphs to customers</p>  </li>  </ul>  <p>Core connection information can be found in sys.event_log as depicted below within SQL Server Management Studio 2012 (run select * from sys.event_log against the <strong>Master</strong> database):</p>  <p><a href=\"\" target=\"_blank\"><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/1055.1.png\" alt=\"\" border=\"0\"></a></p>  <p>Furthermore, deadlock graphs are exposed in the <strong>additional_data</strong> field in sys.event_log (run select * from sys.event_log where event_type = &lsquo;deadlock&rsquo; against the <strong>Master</strong> database):</p>  <p><br> <a href=\"\" target=\"_blank\"><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/3542.2.png\" alt=\"\" border=\"0\"></a></p>  <h4>The sys.database_connection_stats View</h4>  <p>Database connection statistics expose a rollup of key failures in each database over time.&nbsp; The sys.database_connection_stats view gives insight into how many incoming TDS connections are successful, terminated, or throttled: failures are aggregated to a five minute window.&nbsp;</p>  <p>An example of the kind of data in this table is shown below (run select * from sys.database_connection_stats against the <strong>Master</strong> database):</p>  <p><a href=\"\" target=\"_blank\"><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/8272.3.png\" alt=\"\" border=\"0\"></a></p>  <p>Additionally, the Windows Azure Management Portal, for each database, now exposes connection information graphically for easier management of your Windows Azure SQL Databases:</p>  <p><a href=\"\" target=\"_blank\"><img src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/5826.4.png\" alt=\"\" border=\"0\"></a></p>  <h4>Permissions</h4>  <p>The two new&nbsp;system views&nbsp;are accessed by connecting to the master database and only Administrators with permission to access the <strong>master</strong> database have (read-only) access to the views.&nbsp;&nbsp; Because this data is stored in the master database, the room to store this data is not counted as part of the user&rsquo;s bill.</p>  <h4>Latency</h4>  <p>There is some lag from when the connection is made to when an increment for it will show up in the sys.database_connection_stats view.&nbsp; During that time, the information within a single row may be updated after the row is first written.&nbsp; SQL Database is a multi-tenant system with many nodes that participate in handling the connection, each one of those nodes can add data to the row. &nbsp;</p>  <h4>For More Information</h4>  <p>We hope the new views prove useful in managing your databases and getting more detailed diagnostic information. You can read more about these views on MSDN via the links below:</p>  <ul>  <li>sys.event_log</li>  <li>sys.database_connection_stats</li>  </ul>  <p>In addition, Wayne Berry has posted an <a href=\"https://blogs.msdn.com/b/wayneb/archive/2012/11/02/introducing-sys-database-connection-stats-for-troubleshooting-windows-azure-sql-database.aspx\" target=\"_blank\">MSDN blog</a> with further information including some useful queries that can be constructed with these new views.</p>  <p>For questions about these features, you can post on the SQL Database MSDN Support Forum.</p>  <p>Enjoy!</p>  <p>-The Windows Azure SQL Database Team</p>"
}