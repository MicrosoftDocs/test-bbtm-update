{
    "Slug": "announcing-azure-resource-manager-support-azure-automation-runbooks",
    "Title": "Announcing Azure Resource Manager support in Azure Automation runbooks",
    "Summary": "Learn about the new out of box support for Azure Resource Manager in Azure Automation runbooks.",
    "Content": "<p><strong>​Update 2/22/2016: </strong>To respond to a common user question, right now there is no timeline on when additional modules / new versions of modules will be shipped out of box in the Automation service. If you have additional requirements besides what we currently ship globally, these modules / module versions will have to be imported as user modules. <strong>Please note</strong> <strong>the new guidance is that if the latest version of any Azure/AzureRM module is imported as a user module to an automation account, the latest versions of ALL Azure/AzureRM modules (not just the ones that ship out of the box in Azure Automation) should be imported to the automation account</strong>, to avoid any version mismatch issues that could occur now or in the future if Azure Automation later ships any additional (or newer version) Azure/AzureRM modules as global modules. Instructions for importing the Azure/AzureRM modules as user modules can be found here.</p>\n\n<p><strong>​Update 2/1/2016: </strong>​The below post&nbsp;says that the only AzureRM modules shipped out of the box in Azure Automation are AzureRM.Compute and AzureRM.profile. We are now shipping some additional AzureRM modules out of the box&nbsp;as well -- AzureRM.Storage, Azure.Storage, AzureRM.Automation, AzureRM.Resources, and AzureRM.Sql. These modules should be available for use within your Automation account with no additional effort. If you have&nbsp;already imported your own version of any of these modules to your automation account, you can delete them to cause your automation account to start to use our global versions of these modules&nbsp;instead.</p>\n\n<p>&nbsp;</p>\n\n<p>As more and more functionality of Azure is introduced via the new <a href=\"https://azure.microsoft.com/en-us/documentation/articles/resource-group-overview/\">Azure Resource Manager</a> management layer of Azure, we on the Azure Automation team are asked <a href=\"https://feedback.azure.com/forums/246290-azure-automation/suggestions/6634825-enable-azureresourcemanager-module-in-azure-automa\">more and more</a> for out-of-the-box support for the Azure Resource Manager cmdlets in Azure Automation, allowing all new Azure functionality to be easily automated. We&rsquo;ve <a href=\"https://azure.microsoft.com/en-us/blog/using-azure-resource-manager-in-azure-automation-runbooks/\">shown how to import the modules manually</a> in the past, to help users unblock themselves and use Azure Resource Manager in Azure Automation, but out-of-the-box support was missing &hellip; until now. I&rsquo;m excited to announce we&rsquo;ve started to ship the Azure Resource Manager cmdlets in Azure Automation!</p>\n\n<p>But enough talk, let&rsquo;s look at a real example, shall we? Say you want to automate actions against both your Azure classic virtual machines (through Azure Service Management), and your cool new V2 virtual machines (through Azure Resource Manager) from the same runbook. That&rsquo;s now incredibly simple in Azure Automation. Let&rsquo;s use this PowerShell script runbook as an example:</p>\n\n<pre>\n# TODO: update to the name of the credential asset in your Automation account\n$AutomationCredentialAssetName = &quot;AzureCreds&quot;\n\n# Get the credential asset with access to my Azure subscription\n$Cred = Get-AutomationPSCredential -Name $AutomationCredentialAssetName\n\n# Authenticate to Azure Service Management and Azure Resource Manager\nAdd-AzureAccount -Credential $Cred | Out-Null\nAdd-AzureRmAccount -Credential $Cred | Out-Null\n\n# Get and output Azure classic VMs\n$VMs = Get-AzureVM\n$VMs.Name\n&quot;`n--------------`n&quot;\n\n# Get and output Azure v2 VMs\n$VMsv2 = Get-AzureRmVM\n$VMsv2.Name</pre>\n\n<p>Without importing any modules myself, running this against my Azure subscription outputs:</p>\n\n<p><img alt=\"Announcing Azure Resource Manager support in Azure Automation runbooks\" border=\"0\" height=\"300\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/61391a23-5ca4-4555-96d0-bcd0019f2e16.png\" style=\"border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto\" title=\"Announcing Azure Resource Manager support in Azure Automation runbooks\" width=\"360\"></p>\n\n<p>This looks correct, given the VMs in my Azure subscription:</p>\n\n<p><img alt=\"Announcing Azure Resource Manager support in Azure Automation runbooks\" border=\"0\" height=\"200\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/066d3dbd-08cc-4dd6-b02d-4633cdfc7fe3.png\" style=\"border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto\" title=\"Announcing Azure Resource Manager support in Azure Automation runbooks\" width=\"360\"></p>\n\n<p>&nbsp;</p>\n\n<p><img alt=\"Announcing Azure Resource Manager support in Azure Automation runbooks\" border=\"0\" height=\"360\" src=\"https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/50b7409c-fe8e-49d5-aa31-3403b4cc7db2.png\" style=\"border-left-width: 0px; border-right-width: 0px; border-bottom-width: 0px; float: none; margin-left: auto; display: block; border-top-width: 0px; margin-right: auto\" title=\"Announcing Azure Resource Manager support in Azure Automation runbooks\" width=\"326\"></p>\n\n<p>Just like the Azure Service Management cmdlets, the Azure Resource Manager cmdlets support <a href=\"https://azure.microsoft.com/en-us/blog/azure-automation-authenticating-to-azure-using-azure-active-directory/\">authentication via a user principal organizational identity</a> &ndash; you just use a slightly different cmdlet to do that authentication (Add-AzureRmAccount instead of Add-AzureAccount). The Azure Resource Manager cmdlets also support <a href=\"https://blog.davidebbo.com/2014/12/azure-service-principal.html\">service principal authentication</a>, however, due to a <a href=\"https://github.com/Azure/azure-powershell/issues/655\">bug</a> is not yet supported in Azure Automation.</p>\n\n<p>Currently, only the <a href=\"https://www.powershellgallery.com/packages/AzureRM.profile/\">AzureRM.profile</a> and <a href=\"https://www.powershellgallery.com/packages/AzureRM.Compute/\">AzureRM.Compute</a> PowerShell modules are shipped out-of-the-box as global modules in Azure Automation, but we will be introducing more and more of the Azure Resource Manager modules as global modules over the coming months. For now, if you are trying to automate management of your Azure V2 virtual machines (such as to save money by automatically shutting down VMs after business hours and automatically starting them up again right before business hours begin), you should be able to do so. You can continue to follow these instructions to manually import any additional (or newer version)&nbsp;Azure / Azure Resource Manager modules you need for your scenarios. <b>Please note</b> <strong>the new guidance is that if the latest version of any Azure/AzureRM module is imported as a user module to an automation account, the latest versions of ALL Azure/AzureRM modules (not just the ones that ship out of the box in Azure Automation) should be imported to the automation account</strong>, to avoid any version mismatch issues that could occur now or in the future if Azure Automation later ships any additional (or newer version) Azure/AzureRM modules as global modules.</p>\n\n<p>Looking for specific Azure Resource Manager functionality to be available in Azure Automation? Post in the comments with the modules/functionality you&rsquo;re looking for so we can better prioritize the order of modules we ship.</p>\n\n<p>Just getting started with Azure Automation? Learn about the service <a href=\"https://aka.ms/Q2p1ap\">here</a>, and follow Azure Automation on <a href=\"https://twitter.com/AzureAutomation\">Twitter</a>.</p>\n"
}